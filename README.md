# Проект для Docker

Для нашего проекта с Flask-приложением, которое должно работать с аутентификацией пользователей Windows через keycloack, мы создадим несколько компонентов, включая Dockerfile, docker-compose.yml, приложение Flask (app.py), конфигурации для Nginx и другие необходимые файлы. Остановимся на следующих шагах:

1) Настроим Flask для обработки аутентификации с использованием keycloack.
2) Будем использовать Nginx в качестве прокси-сервера, чтобы настроить проверку аутентификации при работе с keycloack через nginx
3) Используем Docker Compose для настройки и запуска всего окружения.

Теперь наше приложение на Flask будет доступно через nginx, и аутентификация будет происходить через Keycloak. После успешной аутентификации nginx будет передавать имя пользователя через REMOTE_USER в приложение Flask.

# Техническая составляющая
## Dockerfile
В Dockerfile мы устанавливаем все зависимости для Flask-приложения.

## app.py
Это наше простое приложение Flask. Оно будет выводить логи имени пользователя, который прошел аутентификацию (передается через REMOTE_USER).

## nginx.conf
Этот файл будет настраивать nginx как реверс-прокси для нашего Flask-приложения и будет работать с аутентификацией через keycloak.

## docker-compose.yml
Для запуска проекта с использованием нескольких контейнеров, определим docker-compose.yml. Этот файл настроит все контейнеры: Flask-приложение, nginx и Keycloak.

## Настройка keycloack

1) После запуска контейнера Keycloak, перейдите в интерфейс Keycloak по адресу http://localhost:8080 с логином и паролем admin/admin.

2) Создание Realm:
В интерфейсе Keycloak создайте новый Realm, например, с названием myrealm.

3) Создание клиента:

Перейдите в раздел Clients и создайте новый клиент с названием flask-app.
Выберите OpenID Connect в качестве типа клиента.
Укажите Redirect URI, например, http://localhost/callback.
Включите клиента для аутентификации.

4) Настройка ролей и пользователей (если необходимо):
Для управления доступом создайте роли в разделе Roles.
Присвойте роли пользователям в разделе Users.


# Запуск проекта
1. Собрать и запустить контейнеры с помощью Docker Compose:

docker-compose up --build

Docker Compose создаст три контейнера:
Flask: Контейнер с вашим приложением.
Nginx: Контейнер с прокси-сервером, который будет направлять трафик к Flask и обрабатывать аутентификацию через Keycloak.
Keycloak: Контейнер с сервером аутентификации.

# Проверка работы
1) Перейдите в браузере по адресу http://localhost. Когда вы посетите этот адрес, Nginx проверит аутентификацию через Keycloak. Если пользователь не аутентифицирован, он будет перенаправлен на страницу входа.

2) После успешной аутентификации, вы увидите страницу с информацией о пользователе, переданную через переменную REMOTE_USER.

3) Если аутентификация не прошла, Nginx вернёт ошибку или перенаправит пользователя на страницу входа.

